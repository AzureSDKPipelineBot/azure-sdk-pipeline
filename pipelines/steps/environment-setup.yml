parameters:
  - name: sdk
    type: string

  - name: specRepoUrl
    type: string

  - name: specRepoBaseBranch
    type: string

  - name: sdkRepoUrl
    type: string

  - name: sdkRepoBaseBranch
    type: string

steps:
  - bash: |
        git clone --branch ${{ parameters.specRepoBaseBranch }} ${{ parameters.specRepoUrl }}
    displayName: Clone Spec Repo
    workingDirectory: ../

  - bash: |
        git clone --branch ${{ parameters.sdkRepoBaseBranch }} ${{ parameters.sdkRepoUrl }}
    displayName: Clone Sdk Repo
    workingDirectory: ../

  - task: NodeTool@0
    inputs:
      versionSpec: 14.x

  - task: Npm@1
    displayName: Npm Install Dependencies of Sdk Generation Tool
    inputs:
      workingDir: tools/sdk-generation
      command: install


  - task: Npm@1
    displayName: Build Sdk Generation Tool
    inputs:
      workingDir: tools/sdk-generation
      command: custom
      customCommand: run build

  - task: Npm@1
    displayName: Pack Sdk Generation Tool
    inputs:
      workingDir: tools/sdk-generation
      command: custom
      customCommand: pack

  - bash: |
      PACKAGE_TGZ=`ls sdk-generation-lib-*.tgz`
      npm install -g ${PACKAGE_TGZ}
    displayName: Install Sdk Automation Tool
    workingDirectory: tools/sdk-generation

  - bash: |
      npm install -g autorest
    displayName: Install Autorest
